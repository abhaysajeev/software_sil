[
 {
  "breadcrumbs": null,
  "content_type": "HTML",
  "context_script": null,
  "css": "",
  "docstatus": 0,
  "doctype": "Web Page",
  "dynamic_route": 1,
  "dynamic_template": 0,
  "enable_comments": 0,
  "end_date": null,
  "full_width": 1,
  "header": "",
  "insert_style": 1,
  "javascript": "frappe.ready(function () {\n    // Function to format time to 12-hour format with AM/PM\n    function formatTimeTo12Hour(timeString) {\n        const [hours, minutes, seconds] = timeString.split(\":\").map(Number);\n        const period = hours >= 12 ? \"PM\" : \"AM\";\n        const formattedHours = hours % 12 || 12; // Convert 0 to 12 for 12-hour format\n        return `${formattedHours}:${String(minutes).padStart(2, \"0\")} ${period}`;\n    }\n\n    // Function to fetch and populate attendance data\n    function fetchAttendanceData() {\n        const employeeName = document.getElementById(\"employee\").value.trim();\n        const attendanceDate = document.getElementById(\"date\").value;\n\n        // Validate inputs\n        if (!employeeName || !attendanceDate) {\n            console.warn(\"Employee name and date are required to fetch attendance data.\");\n            return;\n        }\n\n        // Relative API URL\n        const apiUrl = `/api/method/software_sil.operations.employee_attendance.get_attendance?date=${attendanceDate}&employee_name=${encodeURIComponent(employeeName)}`;\n\n        // Fetch data from API\n        fetch(apiUrl)\n            .then((response) => {\n                if (!response.ok) {\n                    throw new Error(\"Failed to fetch attendance data.\");\n                }\n                return response.json();\n            })\n            .then((data) => {\n                if (data.message) {\n                    // Extract response data\n                    const attendanceData = data.message;\n                    const totalWorkingHours = attendanceData.working_hours;\n                    const sessions = attendanceData.attendance_sessions;\n\n                    // Populate Total Working Hours\n                    document.getElementById(\"total-hours\").textContent = totalWorkingHours;\n\n                    // Populate Table\n                    const tableBody = document.querySelector(\"#attendance-table tbody\");\n                    tableBody.innerHTML = \"\"; // Clear any existing rows\n\n                    sessions.forEach((sessionObj) => {\n                        const sessionKey = Object.keys(sessionObj)[0]; // e.g., \"session 1\"\n                        const sessionData = sessionObj[sessionKey];\n\n                        // Convert in_time and out_time to 12-hour format\n                        const formattedInTime = formatTimeTo12Hour(sessionData.in_time);\n                        const formattedOutTime = formatTimeTo12Hour(sessionData.out_time);\n\n                        const row = `\n                            <tr>\n                                <td>${sessionKey}</td>\n                                <td>${formattedInTime}</td>\n                                <td>${formattedOutTime}</td>\n                                <td>${sessionData.working_hours}</td>\n                            </tr>`;\n                        tableBody.innerHTML += row;\n                    });\n                } else {\n                    console.warn(\"No attendance data found.\");\n                }\n            })\n            .catch((error) => {\n                console.error(\"Error fetching attendance data:\", error);\n            });\n    }\n\n    // Add event listeners for input changes\n    document.getElementById(\"employee\").addEventListener(\"input\", fetchAttendanceData);\n    document.getElementById(\"date\").addEventListener(\"change\", fetchAttendanceData);\n\n    // Optionally fetch data on page load\n    fetchAttendanceData();\n});\n",
  "main_section": null,
  "main_section_html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Employee Attendance Viewer</title>\n    <!-- Bootstrap CSS -->\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <style>\n        nav.navbar.navbar-light.navbar-expand-lg {\n            display: none;\n        }\n        footer.web-footer {\n            display: none;\n        }\n        .label-span {\n            font-size: 0.875rem;\n            color: #6c757d;\n        }\n    </style>\n</head>\n<body class=\"bg-info\">\n    <div class=\"container mt-5\">\n        <!-- Card with responsive width -->\n        <div class=\"card shadow-sm rounded-4 mx-auto w-100 w-md-75\">\n            <!-- Card Header -->\n            <div class=\"card-header text-center bg-dark text-white fw-bold rounded-bottom rounded-4 p-3\">\n                EMPLOYEE ATTENDANCE\n            </div>\n            <div class=\"card-body\">\n                <!-- Row for Employee Attendance, Date, and Total Working Hours -->\n                <div class=\"row g-3 mb-2\">\n                    <div class=\"col-12 col-md-3\">\n                        <label for=\"employee\" class=\"form-label text-secondary\">Employee Name:</label>\n                        <input type=\"text\" id=\"employee\" name=\"employee\" class=\"form-control rounded-3 p-3 fw-bold\" placeholder=\"Enter Employee Name\">\n                    </div>\n                    <div class=\"col-12 col-md-3\">\n                        <label for=\"date\" class=\"form-label text-secondary\">Date:</label>\n                        <input type=\"date\" id=\"date\" name=\"date\" class=\"form-control rounded-3\">\n                    </div>\n                    <div class=\"col-12 col-md-3\"></div>\n                    <div class=\"col-12 col-md-3 d-flex align-items-end\">\n                        <div class=\"w-100\">\n                            <span class=\"label-span\">Total Working Hours:</span>\n                            <div id=\"total-hours\" class=\"border rounded-3 bg-light p-0 fw-bold text-center fs-3\">0 hours</div>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"table-responsive overflow-auto mt-4 rounded-2\">\n                    <table id=\"attendance-table\" class=\"table table-striped text-center\">\n                        <thead class=\"table-primary\">\n                            <tr>\n                                <th>Session</th>\n                                <th>Check-In Time</th>\n                                <th>Check-Out Time</th>\n                                <th>Working Hours</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <!-- Dynamic rows will be populated here -->\n                        </tbody>\n                    </table>\n                </div>\n                <!-- Button to mark attendance -->\n                <div class=\"d-flex justify-content-end\">\n                    <button id=\"mark-attendance-btn\" class=\"btn btn-dark mt-3\">Mark Attendance</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    <!-- Bootstrap JS -->\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"populate.js\"></script> <!-- Include the script -->\n</body>\n</html>\n",
  "main_section_md": null,
  "meta_description": null,
  "meta_image": null,
  "meta_title": null,
  "modified": "2024-12-20 09:27:28.223891",
  "module": "Software Sil",
  "name": "employee-attendance",
  "page_blocks": [],
  "published": 1,
  "route": "attendance-check",
  "show_sidebar": 0,
  "show_title": 0,
  "slideshow": null,
  "start_date": null,
  "text_align": "Left",
  "title": "Employee Attendance Check",
  "website_sidebar": null
 }
]